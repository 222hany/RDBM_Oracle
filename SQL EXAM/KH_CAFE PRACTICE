==========테이블 생성==========
CREATE TABLE CAFES(
C_ID INT PRIMARY KEY,
C_NAME VARCHAR2(255) NOT NULL,
ADDRESS VARCHAR2(255),
PHONE_NUMBER VARCHAR2(15),
OPERATING_HOURS VARCHAR2(255)
);

CREATE TABLE MENU(
MENU_ID INT PRIMARY KEY,
C_ID INT,
MENU_NAME VARCHAR2(255) NOT NULL,
PRICE NUMBER(8,2) NOT NULL,
CONSTRAINT FK_CAFE
    FOREIGN KEY(C_ID)
    REFERENCES CAFES(C_ID)
);

CREATE TABLE ORDERS(
ORDER_ID NUMBER PRIMARY KEY,
C_ID NUMBER,
MENU_ID NUMBER,
ORDER_DATE TIMESTAMP,
QUANTITY NUMBER,
TOTAL_PRICE NUMBER
);

//외래키 제약조건 추가
ALTER TABLE ORDERS ADD
CONSTRAINT FK_ORDERS_CAFE
    FOREIGN KEY(C_ID)
    REFERENCES CAFES(C_ID);

ALTER TABLE ORDERS ADD
CONSTRAINT FK_ORDERS_MENU
    FOREIGN KEY(MENU_ID)
    REFERENCES MENU(MENU_ID);

==========데이터INSERT==========
INSERT INTO MENU(MENU_ID, C_ID, MENU_NAME, PRICE)
VALUES (1, 1, '에스프레소', 3.50);

//MENU 테이블에 DESCRIPTION 열 추가
ALTER TABLE MENU ADD DESCRIPTION VARCHAR2(500);

//데이터 수정
UPDATE MENU SET DESCRIPTION = '강렬한 에스프레소 커피 영국을 느낄 수 있음' WHERE MENU_ID = 1 AND C_ID = 1;

INSERT INTO ORDERS (ORDER_ID, C_ID, MENU_ID, ORDER_DATE, QUANTITY, TOTAL_PRICE)
VALUES (1, 1, 1, TIMESTAMP '2023-10-11 14:30:00', 2, 7.00);

//테이블에 코멘트 달기
COMMENT ON TABLE ORDERS IS '주문 정보를 저장하는 테이블';

//행에 코멘트 달기
COMMENT ON COLUMN ORDERS.ORDER_ID IS '주문을 고유하게 식별하는 번호';

//행 삭제하기
DELETE FROM ORDERS WHERE ORDER_ID = 36;
DELETE FROM ORDERS WHERE ORDER_ID BETWEEN 33 AND 35;
DELETE FROM ORDERS WHERE ORDER_ID BETWEEN 10 AND 23;

==========시퀀스&트리거==========
CREATE SEQUENCE CAFE_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE OR REPLACE TRIGGER CAFE_TRIGGER
BEFORE INSERT ON CAFES
FOR EACH ROW
BEGIN 
    SELECT CAFE_SEQ.NEXTVAL
    INTO:NEW.C_ID
    FROM DUAL;
END;
/

==========뷰 생성하기==========
CREATE VIEW CAFE_ORDER_MENU AS
SELECT O.ORDER_ID, C.C_NAME, M.MENU_NAME, O.ORDER_DATE, O.QUANTITY, M.PRICE, (O.QUANTITY * M.PRICE) AS TOTAL_PRICE
FROM ORDERS O
JOIN CAFES C ON O.C_ID = C.C_ID
JOIN MENU M ON O.MENU_ID = M.MENU_ID;
